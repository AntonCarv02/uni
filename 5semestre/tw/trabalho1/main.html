<!DOCTYPE html>
<html lang="pt">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" type="text/css" href="style.css">
    <title>Agendamento de Vacinação Alentejo</title>
</head>

<body>
    <header>
        <img src="https://www.farmaciasportuguesas.pt/media/logo/default/brand-logotipo-simbolo-principal-copy_3x.png"
            alt="Logotipo Farmácias Portuguesas" class="logo">
        <h1>Agendamento de Vacinação Alentejo</h1>
        <nav>
            <ul>
                <li><a href="#">Página Inicial</a></li>
                <li><a href="#">Agendar Vacinação</a></li>
                
            </ul>
        </nav>
    </header>



    <main>
        <h2>Farmácias Aderentes</h2>
        <label for="filter-vaccine" class="filter-label">Filtrar por vacina:</label>
        <select id="filter-vaccine">
            <option value="all">Todas</option>
            <option value="gripe">Gripe</option>
            <option value="covid19">COVID-19</option>
        </select>
        <label for="filter-city" class="filter-label">Filtrar por cidade:</label>
        <input type="text" id="filter-city" placeholder="Digite a cidade">
        <label for="filter-name-city" class="filter-label">Pesquisar por Nome ou Cidade:</label>
        <input type="text" id="filter-name-city" placeholder="Digite o nome ou cidade">
        <ul class="pharmacies-list" id="pharmacies-list">
            <!-- A lista de farmácias será gerada dinamicamente aqui -->
        </ul>
        <ul class="pagination" id="pagination">
            <!-- A paginação será gerada dinamicamente aqui -->
        </ul>
    </main>



    <script>
        // Dados de farmácias (simulados)
        function getFarmacias() {
            var xhttp = new XMLHttpRequest();
            xhttp.onreadystatechange = function () {
                if (this.readyState === 4 && this.status === 200) {
                    var data = JSON.parse(this.responseText);
                    var farmacias = data.farmacias;
                    var datadiv = document.getElementById("farmacias");
                    datadiv.innerHTML = "";

                    farmacias.forEach(function (farmacia) {
                        var farmaciaItem = document.createElement("p");

                        farmaciaItem.textContent = `Nome: ${farmacia.name}, Localidade: ${farmacia.postal_code_locality}`;
                        datadiv.appendChild(farmaciaItem);
                    });
                } else {
                    console.error("Erro na solicitação. Status: " + this.status);
                }
            };

            var url = "https://magno.di.uevora.pt/tweb/t1/farmacia/list"; // Substitua pelo URL real do servidor
            xhttp.open("GET", url, true);
            xhttp.send();
        }


        function searchFarmacias() {
            var xhttp = new XMLHttpRequest();
            var nomeFarmacia = document.getElementById("nomeFarmacia").value;

            xhttp.onreadystatechange = function () {
                if (this.readyState == 4 && this.status == 200) {
                    var data = JSON.parse(this.responseText);
                    var farmacias = data.farmacias;
                    var datadiv = document.getElementById("farmacias");
                    datadiv.innerHTML = "";

                    farmacias.forEach(function (farmacia) {
                        var farmaciaI = document.createElement("p");

                        farmaciaI.textContent = `Nome: ${farmacia.name}, Localidade: ${farmacia.postal_code_locality}`;
                        datadiv.appendChild(farmaciaI);
                    });
                }
            };

            var url = "https://magno.di.uevora.pt/tweb/t1/farmacia/search?nome=" + nomeFarmacia;
            xhttp.open("GET", url, true);
            xhttp.send();
        }


        function searchFarmaciasByVaccine() {
  var xhttp = new XMLHttpRequest();
  var vacina = document.getElementById("vacina").value;

  xhttp.onreadystatechange = function() {
    if (this.readyState == 4 && this.status == 200) {
      var data = JSON.parse(this.responseText);
      var farmacias = data.farmacias;
      var datadiv = document.getElementById("farmacias");
      datadiv.innerHTML = "";

      farmacias.forEach(function(farmacia) {
        if (vacina === "gripe" && farmacia.vaccines.includes("gripe")) {
          // Exibir apenas farmácias que oferecem a vacina da gripe
          var farmaciaItem = document.createElement("p");
          farmaciaItem.textContent = `Nome: ${farmacia.name}, Localidade: ${farmacia.postal_code_locality}, Vacinas: Gripe`;
          datadiv.appendChild(farmaciaItem);
        } else if (vacina === "covid19" && farmacia.vaccines.includes("covid19")) {
          // Exibir apenas farmácias que oferecem a vacina da COVID-19
          var farmaciaItem = document.createElement("p");
          farmaciaItem.textContent = `Nome: ${farmacia.name}, Localidade: ${farmacia.postal_code_locality}, Vacinas: COVID-19`;
          datadiv.appendChild(farmaciaItem);
        }
      });
    }
  };

  var url = "https://magno.di.uevora.pt/tweb/t1/farmacia/searchvaccine";
  xhttp.open("GET", url, true);
  xhttp.send();
}


function addAgendamento(farmaciaId, data, hora) {
  var xhttp = new XMLHttpRequest();
  
  xhttp.onreadystatechange = function() {
    if (this.readyState == 4 && this.status == 200) {
      // Agendamento adicionado com sucesso, você pode exibir uma mensagem ou atualizar a lista de agendamentos.
    }
  };

  var url = "https://magno.di.uevora.pt/tweb/t1/schedule/add";
  var requestBody = {
    farmacia_id: farmaciaId,
    data: data,
    hora: hora
  };

  xhttp.open("POST", url, true);
  xhttp.setRequestHeader("Content-Type", "application/json;charset=UTF-8");
  xhttp.send(JSON.stringify(requestBody));
}




function listAgendamentos() {
  var xhttp = new XMLHttpRequest();

  xhttp.onreadystatechange = function() {
    if (this.readyState == 4 && this.status == 200) {
      var data = JSON.parse(this.responseText);
      var agendamentos = data.agendamentos;
      var datadiv = document.getElementById("agendamentos");
      datadiv.innerHTML = "";

      agendamentos.forEach(function(agendamento) {
        var agendamentoItem = document.createElement("p");
        agendamentoItem.textContent = `Farmácia ID: ${agendamento.farmacia_id}, Data: ${agendamento.data}, Hora: ${agendamento.hora}`;
        datadiv.appendChild(agendamentoItem);
      });
    }
  };

  var url = "https://magno.di.uevora.pt/tweb/t1/schedule/list";
  xhttp.open("GET", url, true);
  xhttp.send();
}


function removeAgendamento(agendamentoId) {
  var xhttp = new XMLHttpRequest();
  
  xhttp.onreadystatechange = function() {
    if (this.readyState == 4 && this.status == 200) {
      // Agendamento removido com sucesso, você pode exibir uma mensagem ou atualizar a lista de agendamentos.
    }
  };

  var url = "https://magno.di.uevora.pt/tweb/t1/schedule/remove";
  var requestBody = {
    agendamento_id: agendamentoId
  };

  xhttp.open("POST", url, true);
  xhttp.setRequestHeader("Content-Type", "application/json;charset=UTF-8");
  xhttp.send(JSON.stringify(requestBody));
}


function listProgramGripe() {
  var xhttp = new XMLHttpRequest();

  xhttp.onreadystatechange = function() {
    if (this.readyState == 4 && this.status == 200) {
      var data = JSON.parse(this.responseText);
      var programas = data.programas;
      var datadiv = document.getElementById("programasGripe");
      datadiv.innerHTML = "";

      programas.forEach(function(programa) {
        if (programa.tipo === "gripe") {
          var programaItem = document.createElement("p");
          programaItem.textContent = `Nome: ${programa.nome}, Tipo: Gripe`;
          datadiv.appendChild(programaItem);
        }
      });
    }
  };

  var url = "https://magno.di.uevora.pt/tweb/t1/program/gripe/list";
  xhttp.open("GET", url, true);
  xhttp.send();
}

function listProgramCOVID19() {
  var xhttp = new XMLHttpRequest();

  xhttp.onreadystatechange = function() {
    if (this.readyState == 4 && this.status == 200) {
      var data = JSON.parse(this.responseText);
      var programas = data.programas;
      var datadiv = document.getElementById("resultados");
      datadiv.innerHTML = "";

      programas.forEach(function(farmacia) {
        if (farmacia.tipo === "covid19") {
          var programaItem = document.createElement("p");
          programaItem.textContent = `Nome: ${programa.nome}, Tipo: COVID-19`;
          datadiv.appendChild(programaItem);
        }
      });
    }
  };

  var url = "https://magno.di.uevora.pt/tweb/t1/program/covid19/list";
  xhttp.open("GET", url, true);
  xhttp.send();
}


function addProgramaVacinacao(nome, tipo) {
  var xhttp = new XMLHttpRequest();
  
  xhttp.onreadystatechange = function() {
    if (this.readyState == 4 && this.status == 200) {
      // Programa de vacinação adicionado com sucesso, você pode exibir uma mensagem ou atualizar a lista de programas.
    }
  };

  var url = "https://magno.di.uevora.pt/tweb/t1/program/add";
  var requestBody = {
    nome: nome,
    tipo: tipo
  };

  xhttp.open("GET", url, true);
  xhttp.setRequestHeader("Content-Type", "application/json;charset=UTF-8");
  xhttp.send(JSON.stringify(requestBody));
}


function removeProgramaVacinacao(programaId) {
  var xhttp = new XMLHttpRequest();
  
  xhttp.onreadystatechange = function() {
    if (this.readyState == 4 && this.status == 200) {
      // Programa de vacinação removido com sucesso, você pode exibir uma mensagem ou atualizar a lista de programas.
    }
  };

  var url = "https://magno.di.uevora.pt/tweb/t1/program/remove";
  var requestBody = {
    programa_id: programaId
  };

  xhttp.open("POST", url, true);
  xhttp.setRequestHeader("Content-Type", "application/json;charset=UTF-8");
  xhttp.send(JSON.stringify(requestBody));
}


        const pharmaciesList = document.getElementById("pharmacies-list");
        const filterVaccine = document.getElementById("filter-vaccine");
        const filterCity = document.getElementById("filter-city");
        const filterNameCity = document.getElementById("filter-name-city");
        const pagination = document.getElementById("pagination");

        // Configuração da paginação
        const itemsPerPage = 5;
        let currentPage = 1;

        // Função para exibir a lista de farmácias
        function displayPharmacies() {
            const selectedVaccine = filterVaccine.value;
            const selectedCity = filterCity.value.toLowerCase();
            const nameCityFilter = filterNameCity.value.toLowerCase();

            // Filtrar farmácias com base nos critérios selecionados
            const filteredPharmacies = pharmacyData.filter((pharmacy) => {
                if (selectedVaccine !== "all" && !pharmacy.vaccines.includes(selectedVaccine)) {
                    return false;
                }
                if (selectedCity && !pharmacy.city.toLowerCase().includes(selectedCity)) {
                    return false;
                }
                if (nameCityFilter && !pharmacy.name.toLowerCase().includes(nameCityFilter) && !pharmacy.city.toLowerCase().includes(nameCityFilter)) {
                    return false;
                }
                return true;
            });

            // Calcular o índice inicial e final para a paginação
            const startIndex = (currentPage - 1) * itemsPerPage;
            const endIndex = startIndex + itemsPerPage;

            // Exibir farmácias da página atual
            pharmaciesList.innerHTML = filteredPharmacies.slice(startIndex, endIndex).map(pharmacy => `
                <li data-pharmacy-id="${pharmacy.id}">
                    <strong>${pharmacy.name}</strong><br>
                    Cidade: ${pharmacy.city}<br>
                    Vacinas: ${pharmacy.vaccines.join(", ")}
                </li>
            `).join('');

            // Atualizar a paginação
            updatePagination(filteredPharmacies.length);
        }

        // Função para atualizar a paginação
        function updatePagination(totalItems) {
            const totalPages = Math.ceil(totalItems / itemsPerPage);
            const pageNumbers = Array.from({ length: totalPages }, (_, i) => i + 1);
            pagination.innerHTML = pageNumbers.map(page => `
                <li><a href="#" onclick="changePage(${page})">${page}</a></li>
            `).join('');
        }

        // Função para mudar de página
        function changePage(page) {
            currentPage = page;
            displayPharmacies();
        }

        // Event listeners para filtros
        filterVaccine.addEventListener("change", displayPharmacies);
        filterCity.addEventListener("input", displayPharmacies);
        filterNameCity.addEventListener("input", displayPharmacies);

        // Exibir a lista inicial
        displayPharmacies();
    </script>
</body>

</html>